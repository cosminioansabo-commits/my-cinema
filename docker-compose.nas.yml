version: "3.8"

# =============================================================================
# MY-CINEMA NAS DEPLOYMENT
# =============================================================================
# Deploy this on your UGREEN NAS
#
# Before deploying:
# 1. Create folders: /volume1/data/{downloads,movies,tv}
# 2. Create folders: /volume1/docker/{qbittorrent,radarr,sonarr,prowlarr}
# 3. Create .env file with your secrets (see .env.nas.example)
# 4. Update PUID/PGID to match your NAS user (run: id username)
# =============================================================================

services:
  # =========== MY-CINEMA APP ===========

  my-cinema-frontend:
    image: ghcr.io/${GITHUB_USERNAME}/my-cinema-frontend:latest
    container_name: my-cinema-frontend
    restart: unless-stopped
    ports:
      - "80:80"
    depends_on:
      - my-cinema-backend
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  my-cinema-backend:
    image: ghcr.io/${GITHUB_USERNAME}/my-cinema-backend:latest
    container_name: my-cinema-backend
    restart: unless-stopped
    ports:
      - "3001:3001"
    environment:
      - PORT=3001
      - CORS_ORIGIN=http://${NAS_IP}
      - DOWNLOAD_PATH=/data/downloads
      - PROWLARR_URL=http://prowlarr:9696
      - PROWLARR_API_KEY=${PROWLARR_API_KEY}
      - QBITTORRENT_URL=http://qbittorrent:8080
      - QBITTORRENT_USERNAME=${QBITTORRENT_USERNAME}
      - QBITTORRENT_PASSWORD=${QBITTORRENT_PASSWORD}
      - RADARR_URL=http://radarr:7878
      - RADARR_API_KEY=${RADARR_API_KEY}
      - SONARR_URL=http://sonarr:8989
      - SONARR_API_KEY=${SONARR_API_KEY}
    volumes:
      - /volume1/data:/data
    depends_on:
      - qbittorrent
      - radarr
      - sonarr
      - prowlarr
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  # =========== DOWNLOAD SERVICES ===========

  qbittorrent:
    image: linuxserver/qbittorrent:latest
    container_name: qbittorrent
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
      - WEBUI_PORT=8080
    volumes:
      - /volume1/docker/qbittorrent:/config
      - /volume1/data:/data
    ports:
      - "8080:8080"
      - "6881:6881"
      - "6881:6881/udp"
    restart: unless-stopped

  # =========== MEDIA MANAGEMENT ===========

  radarr:
    image: linuxserver/radarr:latest
    container_name: radarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /volume1/docker/radarr:/config
      - /volume1/data:/data
    ports:
      - "7878:7878"
    restart: unless-stopped

  sonarr:
    image: linuxserver/sonarr:latest
    container_name: sonarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /volume1/docker/sonarr:/config
      - /volume1/data:/data
    ports:
      - "8989:8989"
    restart: unless-stopped

  prowlarr:
    image: linuxserver/prowlarr:latest
    container_name: prowlarr
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - TZ=${TZ}
    volumes:
      - /volume1/docker/prowlarr:/config
    ports:
      - "9696:9696"
    restart: unless-stopped

  # =========== AUTO-UPDATE ===========

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    environment:
      - WATCHTOWER_CLEANUP=true
      - WATCHTOWER_POLL_INTERVAL=300
      - WATCHTOWER_LABEL_ENABLE=true
      - WATCHTOWER_INCLUDE_RESTARTING=true
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      # For private GitHub Container Registry
      - /root/.docker/config.json:/config.json:ro
    restart: unless-stopped

networks:
  default:
    name: my-cinema-network
